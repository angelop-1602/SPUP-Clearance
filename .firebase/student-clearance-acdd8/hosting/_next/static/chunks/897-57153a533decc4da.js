"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[897],{647:(e,t,r)=>{r.d(t,{Bh:()=>x,C:()=>g,Rh:()=>u,Vx:()=>b,bN:()=>p,cq:()=>d,hx:()=>m,qT:()=>h,vr:()=>w,wu:()=>f});var a=r(5317),s=r(7505),o=r(5404),i=r(9311),n=r.n(i),l=r(6104),c=r(9427);async function d(e){try{let t=(0,c.g)(),r=new(n());if(e.documents){let t=Object.entries(e.documents).map(async e=>{let[t,a]=e;if(a){let e=a.name.split(".").pop(),s="";switch(t){case"approvalSheet":s="approval_sheet.".concat(e);break;case"fullPaper":s="full_paper.".concat(e);break;case"longAbstract":s="long_abstract.".concat(e);break;case"journalFormat":s="journal_format.".concat(e);break;default:s="".concat(t,".").concat(e)}let o=await a.arrayBuffer();r.file(s,o)}});await Promise.all(t)}let o=await r.generateAsync({type:"blob"}),i=e.name.replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_"),d="".concat(i,"_").concat(t,".zip"),m=(0,s.KR)(l.IG,"submissions/".concat(d)),u=await (0,s.D)(m,o),h=await (0,s.qk)(u.ref),p={id:t,level:e.level,name:e.name,email:e.email,studentId:e.studentId,adviser:e.adviser,course:e.course,graduationMonth:e.graduationMonth,graduationYear:e.graduationYear,researchTitle:e.researchTitle,researchType:e.researchType,zipFile:h,status:"Submitted",submittedAt:a.Dc.fromDate(new Date)};if("undergrad"===e.level&&e.groupMembers&&e.groupMembers.length>0){let t=e.groupMembers.filter(e=>e.name.trim()&&e.studentID.trim());t.length>0&&(p.groupMembers=t)}let f=(0,a.H9)(l.db,"submissions",t);return await (0,a.BN)(f,p),t}catch(e){throw console.error("Error submitting clearance:",e),Error("Failed to submit clearance request. Please try again.")}}async function m(e){try{let r=(0,a.H9)(l.db,"submissions",e),s=await (0,a.x7)(r);if(!s.exists())return null;{var t;let e=s.data();return{...e,id:s.id,submittedAt:(null==(t=e.submittedAt)?void 0:t.toDate())||new Date}}}catch(e){throw console.error("Error fetching submission:",e),Error("Failed to fetch submission details")}}async function u(e){try{let t=(0,a.rJ)(l.db,"submissions"),r=[];(null==e?void 0:e.level)&&"all"!==e.level&&r.push((0,a._M)("level","==",e.level)),(null==e?void 0:e.status)&&"all"!==e.status&&r.push((0,a._M)("status","==",e.status)),(null==e?void 0:e.course)&&r.push((0,a._M)("course","==",e.course)),r.push((0,a.My)("submittedAt","desc"));let s=(await (0,a.GG)((0,a.P)(t,...r))).docs.map(e=>{var t;let r=e.data();return{...r,id:e.id,submittedAt:(null==(t=r.submittedAt)?void 0:t.toDate())||new Date,exportLink:r.exportLink||void 0}});if(null==e?void 0:e.searchTerm){let t=e.searchTerm.toLowerCase();s=s.filter(e=>e.name.toLowerCase().includes(t)||e.studentId.toLowerCase().includes(t)||e.researchTitle.toLowerCase().includes(t)||e.email.toLowerCase().includes(t))}return s}catch(e){throw console.error("Error fetching submissions:",e),Error("Failed to fetch submissions")}}async function h(e,t){try{let r=(0,a.H9)(l.db,"submissions",e);await (0,a.mZ)(r,{status:t})}catch(e){throw console.error("Error updating submission status:",e),Error("Failed to update submission status")}}async function p(e,t){try{if("cprint@spup.edu.ph"!==e)throw Error("Unauthorized email address");return(await (0,o.x9)(l.j2,e,t)).user}catch(e){if(console.error("Error during admin login:",e),e&&"object"==typeof e&&"code"in e){if("auth/user-not-found"===e.code)throw Error("Admin account not found");if("auth/wrong-password"===e.code)throw Error("Invalid password");if("auth/invalid-email"===e.code)throw Error("Invalid email format")}if(e instanceof Error&&"Unauthorized email address"===e.message)throw e;throw Error("Login failed. Please try again.")}}async function f(){try{await (0,o.CI)(l.j2)}catch(e){throw console.error("Error during logout:",e),Error("Logout failed")}}function x(e){return(0,o.hg)(l.j2,e)}async function b(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{let r=(0,a.H9)(l.db,"submissions",e);if(await (0,a.mZ)(r,{isExported:!0,exportedAt:a.Dc.now()}),t)try{let t=await (0,a.x7)(r);if(t.exists()){let r=t.data().name.replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_"),a="".concat(r,"_").concat(e,".zip"),o=(0,s.KR)(l.IG,"submissions/".concat(a));await (0,s.XR)(o),console.log("Deleted file: ".concat(a))}}catch(t){console.warn("Failed to delete file for ".concat(e,":"),t)}}catch(e){throw console.error("Error marking submission as exported:",e),Error("Failed to mark submission as exported")}}async function g(e){try{let t=(0,a.H9)(l.db,"submissions",e);await (0,a.mZ)(t,{exportLink:(0,a.CL)()})}catch(e){throw console.error("Error clearing export link:",e),Error("Failed to clear export link")}}async function w(e,t){try{let r=(0,a.H9)(l.db,"submissions",e);await (0,a.mZ)(r,{exportLink:t})}catch(e){throw console.error("Error setting export link:",e),Error("Failed to set export link")}}},2355:(e,t,r)=>{r.d(t,{V:()=>n});var a=r(5155);r(2115);var s=r(6874),o=r.n(s),i=r(6766);function n(e){let{currentPage:t="home",showAdminLink:r=!0,user:s,onLogout:n}=e;return(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center h-auto sm:h-16 py-3 sm:py-0",children:[(0,a.jsx)("div",{className:"flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4 mb-3 sm:mb-0",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(i.default,{src:"/SPUP-final-logo.png",alt:"St. Paul University Philippines",width:40,height:40,className:"w-8 h-8 sm:w-10 sm:h-10",priority:!0,unoptimized:!0,onError:e=>{var t;console.log("Logo failed to load, showing fallback");let r=e.target;r.style.display="none";let a=null==(t=r.parentElement)?void 0:t.querySelector(".logo-fallback");a&&(a.style.display="flex")}}),(0,a.jsx)("div",{className:"logo-fallback w-8 h-8 sm:w-10 sm:h-10 bg-primary-600 rounded-full items-center justify-center text-white font-bold text-xs sm:text-sm",style:{display:"none"},children:"SPUP"}),(0,a.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-3",children:(0,a.jsx)("h1",{className:"text-lg sm:text-xl font-semibold text-gray-900 text-center sm:text-left",children:"Student Clearance System"})})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[(()=>{let e=[];return"home"!==t&&e.push((0,a.jsx)(o(),{href:"/",className:"text-gray-600 hover:text-gray-900 text-sm font-medium px-3 py-2 rounded-md hover:bg-gray-100 transition-colors",children:"New Submission"},"home")),"track"!==t&&e.push((0,a.jsx)(o(),{href:"/track",className:"text-gray-600 hover:text-gray-900 text-sm font-medium px-3 py-2 rounded-md hover:bg-gray-100 transition-colors",children:"Track Submission"},"track")),r&&"admin"!==t&&e.push((0,a.jsx)(o(),{href:"/admin",className:"text-gray-600 hover:text-gray-900 text-sm font-medium px-3 py-2 rounded-md hover:bg-gray-100 transition-colors",children:"Admin Login"},"admin")),e})(),"admin"===t&&s&&(0,a.jsx)("div",{className:"px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-12",children:[(0,a.jsxs)("div",{className:"text-sm ",children:["Welcome, ",(0,a.jsx)("span",{className:"font-medium",children:s.email})]}),n&&(0,a.jsx)("button",{onClick:n,className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded-md text-sm font-medium transition-colors",children:"Logout"})]})})]})]})})})}},6104:(e,t,r)=>{r.d(t,{IG:()=>d,db:()=>c,j2:()=>l});var a=r(3915),s=r(5404),o=r(5317),i=r(7505);let n=(0,a.Wp)({apiKey:"AIzaSyDQ_OoviqBwI2-po-yFgDmElp5Gu1Roos8",authDomain:"student-clearance-acdd8.firebaseapp.com",projectId:"student-clearance-acdd8",storageBucket:"student-clearance-acdd8.firebasestorage.app",messagingSenderId:"384361416984",appId:"1:384361416984:web:088ba8a9f6be56ad8a366d",measurementId:"G-K0FBFQ3WGD"}),l=(0,s.xI)(n),c=(0,o.aU)(n),d=(0,i.c7)(n)},9427:(e,t,r)=>{function a(){let e=new Date().getFullYear(),t=Math.random().toString(36).substr(2,6).toUpperCase();return"SPUP_Clearance_".concat(e,"_").concat(t)}function s(e){return/^SPUP_Clearance_\d{4}_[A-Z0-9]{6}$/.test(e)}r.d(t,{f:()=>s,g:()=>a})}}]);